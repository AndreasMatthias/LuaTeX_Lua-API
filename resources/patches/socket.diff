--- /home/jf/repos/lua/luatex_api_all/library/luatex/socket.lua_upstream.lua	2023-04-14 21:14:50.682847973 +0200
+++ /home/jf/repos/lua/luatex_api_all/library/luatex/socket.lua	2023-04-14 20:48:09.777665923 +0200
@@ -1,3 +1,10 @@
+_N._4_3_lua_modules = "page 67"
+
+---
+---https://github.com/TeX-Live/luatex/blob/trunk/source/texk/web2c/luatexdir/luasocket/src/socket.lua
+---Changes to upstream: global socket table
+
+---
 ---@meta
 ---The definitions are developed in this repository: https://github.com/LuaCATS/luasocket
 
@@ -14,13 +21,9 @@
 ----- loads the socket module
 ---local socket = require("socket")
 ---```
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 ---@class Socket
-local socket = {}
+socket = {}
 
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 socket.headers = {}
 
 ---
@@ -31,8 +34,6 @@
 ---in this table, the associated value is substituted in
 ---whenever the field name is sent out.
 ---```
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 socket.headers.canonic = {}
 
 ---
@@ -48,8 +49,6 @@
 ---@param address string
 ---@param port integer
 ---@param backlog? any
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 function socket.bind(address, port, backlog) end
 
 ---
@@ -69,8 +68,6 @@
 ---@param locaddr? string
 ---@param locport? integer
 ---@param family? 'inet'|'inet6'
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 function socket.connect(address, port, locaddr, locport, family) end
 
 ---
@@ -90,8 +87,6 @@
 ---@param locaddr? string
 ---@param locport? integer
 ---@param family? 'inet'|'inet6'
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 function socket.connect4(address, port, locaddr, locport, family) end
 
 ---
@@ -111,8 +106,6 @@
 ---@param locaddr? string
 ---@param locport? integer
 ---@param family? 'inet'|'inet6'
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 function socket.connect6(address, port, locaddr, locport, family) end
 
 ---
@@ -120,8 +113,6 @@
 ---with debug support.
 ---
 ---@type boolean
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 socket._DEBUG = true
 
 ---
@@ -131,8 +122,6 @@
 ---(Unless changed in compile time, the value is 8192.)
 ---
 ---@type integer
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 socket._DATAGRAMSIZE = 8192
 
 ---
@@ -144,8 +133,6 @@
 ----- do stuff
 ---print(socket.gettime() - t .. " seconds elapsed")
 ---```
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 function socket.gettime() end
 
 ---
@@ -175,8 +162,6 @@
 ---@param finalizer function # -`Finalizer` is a function that will be called before `try` throws the exception.
 ---
 ---@return function # The function returns your customized `try` function.
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 function socket.newtry(finalizer) end
 
 ---
@@ -188,8 +173,6 @@
 ---@param func function # `func` is a function that calls `try` (or `assert`, or `error`) to throw exceptions.
 ---
 ---@return function # Returns an equivalent function that instead of throwing exceptions in case of a failed `try`call, returns `nil` followed by an error message.
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 function socket.protect(func) end
 
 ---
@@ -237,14 +220,11 @@
 ---maximum amount of time (in seconds) to wait for a change in status.  A
 ---`nil`, negative or omitted `timeout` value allows the
 ---function to block indefinitely.
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 function socket.select(recvt, sendt, timeout) end
 
+---
 --- The maximum number of sockets that the select function can handle.
 ---@type integer
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 socket._SETSIZE = 0
 
 ---
@@ -268,8 +248,6 @@
 ---
 ---@param mode 'http-chunked'|'close-when-done'|'keep-open'
 ---@param socket any
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 function socket.sink(mode, socket) end
 
 ---
@@ -282,7 +260,6 @@
 ---
 ---Note: This function is useful to avoid creation of dummy variables:
 ---
----
 ---```
 ----- get the status code and separator from SMTP server reply
 ---local code, sep = socket.skip(2, string.find(line, "^(%d%d%d)(.?)"))
@@ -290,8 +267,6 @@
 ---
 ---@param d integer
 ---@param ... any
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 function socket.skip(d, ...) end
 
 ---
@@ -301,8 +276,6 @@
 ---`time` is negative, the function returns immediately.
 ---
 ---@param time integer
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 function socket.sleep(time) end
 
 ---
@@ -327,19 +300,15 @@
 ---@param mode 'http-chunked'|'by-length'|'until-closed'
 ---@param socket any
 ---@param timeout integer
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 function socket.source(mode, socket, timeout) end
 
+---
 ---The OS value for an invalid socket. This can be used with
 ---`tcp:getfd`and `tcp:setfd`methods.
 ---@type any
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 socket._SOCKETINVALID = nil
 
 ---
----
 ---Throws an exception in case `ret1` is falsy, using
 ---`ret2` as the error message. The exception is supposed to be caught
 ---by a `protect`ed function only.
@@ -360,15 +329,11 @@
 ---```
 ---
 ---@param ... any
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 function socket.try(...) end
 
 ---
 ---This constant has a string describing the current LuaSocket version.
 ---@type string
----
----😱 [Types](https://github.com/LuaCATS/luasocket/blob/main/library/socket.lua) incomplete or incorrect? 🙏 [Please contribute!](https://github.com/LuaCATS/luasocket/pulls)
 socket._VERSION = ""
 
 return socket
